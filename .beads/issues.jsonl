{"id":"plonk-0cw","title":"Delete Resource interface and shared code","description":"Remove Resource interface, shared reconciliation abstractions, and any orphaned code after domain-specific implementations are working.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:46:14.458047-07:00","updated_at":"2025-12-22T19:01:26.932335-07:00","closed_at":"2025-12-22T19:01:26.932335-07:00","close_reason":"Resource interface deleted in plonk-5j8, docs updated to reflect new architecture","dependencies":[{"issue_id":"plonk-0cw","depends_on_id":"plonk-8al","type":"blocks","created_at":"2025-12-22T12:46:26.679433-07:00","created_by":"daemon"}]}
{"id":"plonk-0na","title":"Define packages-specific operation result types","description":"Move operations.Result usage in packages to domain-specific types. InstallPackages/UninstallPackages should return packages.OperationResult or similar, not a shared type. Convert to output types at the commands boundary.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:49:44.298283-07:00","updated_at":"2025-12-22T21:28:43.304319-07:00","closed_at":"2025-12-22T21:28:43.304319-07:00","close_reason":"Implemented domain-specific result types for packages operations"}
{"id":"plonk-11f","title":"Consolidate dry-run tests into dedicated file","description":"## Problem\nDry-run tests are scattered across multiple files with repetitive patterns:\n\n### Current Distribution\n| File | Dry-run Tests |\n|------|---------------|\n| `03-package-install.bats` | 5 tests |\n| `04-package-uninstall.bats` | 1 test |\n| `05-dotfile-add.bats` | 1 test |\n| `06-dotfile-rm.bats` | 1 test |\n| `07-apply-behavior.bats` | 3 tests |\n| `08-package-upgrade.bats` | 5 tests |\n| `10-drift-and-sync.bats` | 1 test |\n| `13-clone-command.bats` | 4 tests |\n\n### Common Pattern\nAll dry-run tests follow this structure:\n1. Setup some state\n2. Run command with `--dry-run` or `-n`\n3. Assert output contains \"would-X\" or \"Would X\"\n4. Verify no actual changes were made\n\n## Proposed Solution\nCreate `11-dry-run-behavior.bats` with consolidated tests:\n\n```bash\n# Test that all commands support dry-run\n@test \"all commands support --dry-run flag\" {\n  # install\n  run plonk install --dry-run brew:cowsay\n  assert_success\n  assert_output --partial \"would\"\n  \n  # uninstall (with setup)\n  # ...\n}\n\n@test \"-n is alias for --dry-run on all commands\" {\n  run plonk install -n brew:cowsay\n  assert_output --partial \"would\"\n  \n  run plonk upgrade -n brew:cowsay\n  assert_output --partial \"would\"\n  # ...\n}\n\n@test \"dry-run never modifies state\" {\n  # Comprehensive test that dry-run doesn't modify:\n  # - Lock file\n  # - System packages\n  # - Dotfiles\n}\n```\n\n## Benefits\n- Single place to verify dry-run behavior\n- Easier to ensure all commands support dry-run consistently\n- Reduces duplication across files\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:59:50.86873-07:00","updated_at":"2025-12-23T14:40:17.228505-07:00","closed_at":"2025-12-23T14:40:17.228505-07:00","close_reason":"Consolidated 13 dry-run tests from 5 files into new 17-dry-run-behavior.bats"}
{"id":"plonk-1bg","title":"Update registry and cleanup after npm/pnpm/bun split","description":"Finalize the npm/pnpm/bun manager split by updating the registry and cleaning up.\n\n**Scope:**\n- Update registry.go to use new constructors:\n  - NewNPMManager(exec) instead of NewNPMManager(ProviderNPM, exec)\n  - NewPNPMManager(exec) instead of NewNPMManager(ProviderPNPM, exec)\n  - NewBunManager(exec) instead of NewNPMManager(ProviderBun, exec)\n- Split npm_test.go into npm_test.go, pnpm_test.go, bun_test.go\n- Remove NPMProvider type and old combined implementation\n- Run all tests to verify\n\n**Depends on:** plonk-rtw, plonk-8ht, plonk-sy9\n\n**Acceptance:**\n- All tests pass\n- No references to NPMProvider remain\n- Each manager has its own test file","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:49:47.941284-07:00","updated_at":"2025-12-23T12:19:23.23965-07:00","closed_at":"2025-12-23T12:19:23.23965-07:00","close_reason":"Removed npm_legacy.go and npm_legacy_test.go. All tests pass. npm/pnpm/bun split complete.","dependencies":[{"issue_id":"plonk-1bg","depends_on_id":"plonk-rtw","type":"blocks","created_at":"2025-12-23T11:49:52.700929-07:00","created_by":"daemon"},{"issue_id":"plonk-1bg","depends_on_id":"plonk-8ht","type":"blocks","created_at":"2025-12-23T11:49:52.792216-07:00","created_by":"daemon"},{"issue_id":"plonk-1bg","depends_on_id":"plonk-sy9","type":"blocks","created_at":"2025-12-23T11:49:52.883108-07:00","created_by":"daemon"}]}
{"id":"plonk-1c8","title":"Simplify plonk core architecture","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T12:43:40.831371-07:00","updated_at":"2025-12-22T15:38:13.396256-07:00","closed_at":"2025-12-22T15:38:13.396256-07:00","close_reason":"Epic complete. Removed all config-driven manager code and simplified the architecture. See plonk-720 and plonk-cqk for details.","dependencies":[{"issue_id":"plonk-1c8","depends_on_id":"plonk-720","type":"blocks","created_at":"2025-12-22T15:03:25.065489-07:00","created_by":"daemon"},{"issue_id":"plonk-1c8","depends_on_id":"plonk-cqk","type":"blocks","created_at":"2025-12-22T15:03:25.1569-07:00","created_by":"daemon"}]}
{"id":"plonk-2cl","title":"Update output formatters to use domain-specific types","description":"Update output/formatters.go and related files to handle domain-specific types instead of resources.Item.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T19:26:03.237794-07:00","updated_at":"2025-12-22T20:20:59.155548-07:00","closed_at":"2025-12-22T20:20:59.155548-07:00","close_reason":"Removed resources import from output package. Created SerializableRemovalResult type in rm_formatter.go, updated rm.go to convert OperationResult to SerializableRemovalResult at the boundary, and updated tests to use new type.","dependencies":[{"issue_id":"plonk-2cl","depends_on_id":"plonk-bs9","type":"blocks","created_at":"2025-12-22T19:26:14.663173-07:00","created_by":"daemon"}]}
{"id":"plonk-2iq","title":"Analyze BATS test suite quality and organization","description":"Perform comprehensive analysis of the BATS test suite as run in Docker through just.\n\n## Scope\nRun and analyze BATS tests via `just docker-*` commands to evaluate:\n\n### Quality Assessment\n- Do tests validate real behavior or just check exit codes?\n- Specific concern: Do upgrade tests actually install an old version and prove upgrading works?\n- Identify any tests that may not catch real-world failure scenarios\n- Check for flaky tests or tests with race conditions\n\n### Consolidation Opportunities\n- Identify duplicate or overlapping test coverage\n- Find tests that could be combined without losing coverage\n- Look for shared setup/teardown that could be extracted\n\n### Reorganization Opportunities  \n- Assess logical grouping of tests\n- Identify tests that may be in the wrong file or category\n- Evaluate naming conventions and consistency\n\n## Deliverables\n1. Summary report of findings\n2. **Create follow-up beads** for each improvement opportunity identified\n3. Prioritize follow-ups based on impact (speed, reliability, maintainability)\n\n## Note\nFollow-up tickets created from this analysis will become dependencies for the parallelization evaluation ticket (plonk-xxx - to be linked).\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:44:51.30479-07:00","updated_at":"2025-12-23T12:02:06.513501-07:00","closed_at":"2025-12-23T12:02:06.513501-07:00","close_reason":"Analysis complete. Created 9 follow-up tickets (plonk-6k7, plonk-8a8, plonk-bl6, plonk-td3, plonk-11f, plonk-hnh, plonk-t8k, plonk-ihz, plonk-ms5) covering upgrade test quality, consolidation opportunities, and reorganization. See ticket descriptions for detailed findings. All follow-ups added as dependencies to parallelization ticket plonk-t3n.","dependencies":[{"issue_id":"plonk-2iq","depends_on_id":"plonk-3gi","type":"blocks","created_at":"2025-12-23T11:45:20.89791-07:00","created_by":"daemon"}]}
{"id":"plonk-2m5","title":"Cache validator instance in config loading","description":"Currently validator.Validate is recreated and validators re-registered on every LoadFromPath() call. Cache at package level for efficiency.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T21:48:55.803772-07:00","updated_at":"2025-12-23T17:32:43.478637-07:00","closed_at":"2025-12-23T17:32:43.478637-07:00","close_reason":"Closed"}
{"id":"plonk-2wm","title":"Review dotfiles package complexity","description":"38 files handling scanning, comparing, templating, and state reconciliation. Look for over-abstraction in file operations.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:37:08.104579-07:00","updated_at":"2025-12-22T21:50:25.13357-07:00","closed_at":"2025-12-22T21:50:25.13357-07:00","close_reason":"Reviewed: 18 production files with good separation of concerns. Delegation pattern is verbose but enables testability. No significant over-abstraction - complexity matches dotfile management requirements."}
{"id":"plonk-3gi","title":"Comprehensive BATS Test Suite Evaluation","description":"Evaluate and improve the BATS test suite to ensure comprehensive, efficient, and reliable testing.\n\n## Goals\n- **Speed**: Optimize slow tests and enable parallelization\n- **Consolidation**: Eliminate duplication across test files\n- **Quality**: Ensure tests validate real behavior (e.g., upgrades actually install old version then upgrade, not just cursory checks)\n- **Coverage**: Catch all user-facing issues without manual testing\n\n## Context\nThe current test suite catches real errors and is not bad, but we want to ensure it's as good as it can be. Specific concerns:\n- Tests are slow\n- Suspected duplication exists\n- Some tests may only perform shallow validations (e.g., do upgrade tests actually test the upgrade path?)\n\n## Approach\n1. Initial analysis to assess quality, identify consolidation/reorganization opportunities\n2. Implement improvements (tickets created from analysis findings)\n3. Post-improvement parallelization evaluation to optimize runtime\n4. Documentation updates (can be worked in parallel, finalized at end)\n\n## Key Requirement\nAll BATS tests must be run through `just docker-*` commands to avoid accidental changes to user's local environment.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T11:44:41.123295-07:00","updated_at":"2025-12-23T18:31:54.48698-07:00","closed_at":"2025-12-23T18:31:54.48698-07:00","close_reason":"Epic complete. Analysis identified consolidation opportunities (implemented), parallelization evaluated (~15-20% possible, limited by shared package manager state), documentation updated with Docker-first approach."}
{"id":"plonk-3wu","title":"Implement hardcoded cargo manager","description":"Create dedicated cargo manager. Self-installation via rustup. Handle cargo install idempotency.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:45:35.309352-07:00","updated_at":"2025-12-22T13:27:24.526812-07:00","closed_at":"2025-12-22T13:27:24.526812-07:00","close_reason":"Implemented CargoManager with PackageManager/PackageUpgrader interfaces, rustup self-install, and idempotent error handling.","dependencies":[{"issue_id":"plonk-3wu","depends_on_id":"plonk-yb6","type":"blocks","created_at":"2025-12-22T12:45:54.284673-07:00","created_by":"daemon"}]}
{"id":"plonk-463","title":"Remove resources.Item usage from packages","description":"Packages already has PackageSpec. Remove the toResourcesResult() conversion in reconcile.go. Return domain-specific types directly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T19:26:02.667243-07:00","updated_at":"2025-12-22T19:45:36.023391-07:00","closed_at":"2025-12-22T19:45:36.023391-07:00","close_reason":"Closed"}
{"id":"plonk-4gj","title":"BATS tests validation and updates","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T13:41:19.90724-07:00","updated_at":"2025-12-22T14:59:43.754658-07:00","closed_at":"2025-12-22T14:59:43.754658-07:00","close_reason":"All BATS and unit tests passing after replacing config-driven managers with hardcoded registry metadata","dependencies":[{"issue_id":"plonk-4gj","depends_on_id":"plonk-tyd","type":"blocks","created_at":"2025-12-22T13:41:24.846511-07:00","created_by":"daemon"}]}
{"id":"plonk-4ko","title":"Review codebase and assess unnecessary complexity","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-22T20:34:49.728244-07:00","updated_at":"2025-12-22T22:18:42.292564-07:00","closed_at":"2025-12-22T22:18:42.292564-07:00","close_reason":"All 8 review tasks completed","dependencies":[{"issue_id":"plonk-4ko","depends_on_id":"plonk-q39","type":"blocks","created_at":"2025-12-22T20:37:17.531988-07:00","created_by":"daemon"},{"issue_id":"plonk-4ko","depends_on_id":"plonk-2wm","type":"blocks","created_at":"2025-12-22T20:37:17.623805-07:00","created_by":"daemon"},{"issue_id":"plonk-4ko","depends_on_id":"plonk-97t","type":"blocks","created_at":"2025-12-22T20:37:17.716516-07:00","created_by":"daemon"},{"issue_id":"plonk-4ko","depends_on_id":"plonk-u4t","type":"blocks","created_at":"2025-12-22T20:37:17.807797-07:00","created_by":"daemon"},{"issue_id":"plonk-4ko","depends_on_id":"plonk-93j","type":"blocks","created_at":"2025-12-22T20:37:17.900008-07:00","created_by":"daemon"},{"issue_id":"plonk-4ko","depends_on_id":"plonk-whr","type":"blocks","created_at":"2025-12-22T20:37:17.992174-07:00","created_by":"daemon"},{"issue_id":"plonk-4ko","depends_on_id":"plonk-iug","type":"blocks","created_at":"2025-12-22T20:37:18.084287-07:00","created_by":"daemon"},{"issue_id":"plonk-4ko","depends_on_id":"plonk-6lt","type":"blocks","created_at":"2025-12-22T20:37:18.174714-07:00","created_by":"daemon"}]}
{"id":"plonk-4ll","title":"Update package manager tests","description":"Update/rewrite tests for new hardcoded manager implementations. Remove tests for deleted config-driven functionality.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:45:44.301736-07:00","updated_at":"2025-12-22T14:27:07.620809-07:00","closed_at":"2025-12-22T14:27:07.620809-07:00","close_reason":"Tests updated: removed pipx/conda/custom/yaml manager tests; GemManager implemented","dependencies":[{"issue_id":"plonk-4ll","depends_on_id":"plonk-tyd","type":"blocks","created_at":"2025-12-22T12:45:59.841291-07:00","created_by":"daemon"},{"issue_id":"plonk-4ll","depends_on_id":"plonk-4yh","type":"blocks","created_at":"2025-12-22T14:06:55.174187-07:00","created_by":"daemon"}]}
{"id":"plonk-4r1","title":"Remove type aliases from commands/shared.go","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T21:55:08.568142-07:00","updated_at":"2025-12-23T16:27:33.263783-07:00","closed_at":"2025-12-23T16:27:33.263783-07:00","close_reason":"Deleted shared.go - type aliases were unused dead code"}
{"id":"plonk-4s9","title":"Extract BaseManager struct for shared package manager logic","description":"Consolidate duplicated patterns across 6 package managers: IsAvailable, Upgrade template, idempotency checking. Each manager has ~15 lines of identical IsAvailable code. Would reduce each manager from ~150 to ~80 lines.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T21:59:01.006182-07:00","updated_at":"2025-12-23T10:14:32.486637-07:00","closed_at":"2025-12-23T10:14:32.486637-07:00","close_reason":"Closed"}
{"id":"plonk-4yh","title":"Add GemManager as built-in hardcoded manager","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T14:06:43.9695-07:00","updated_at":"2025-12-22T14:26:36.916987-07:00","closed_at":"2025-12-22T14:26:36.916987-07:00","close_reason":"GemManager implemented with full test coverage"}
{"id":"plonk-54z","title":"Refactor uninstallSinglePackage complexity","description":"65-line function with complex branching checking isManaged, lockErr vs uninstallErr combinations. Extract error resolution logic into separate function or state machine helper.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T21:59:01.642247-07:00","updated_at":"2025-12-23T16:44:19.937633-07:00","closed_at":"2025-12-23T16:44:19.937633-07:00","close_reason":"Extracted resolveUninstallOutcome helper to encapsulate error resolution logic"}
{"id":"plonk-5j8","title":"Refactor dotfile reconciliation as standalone","description":"Extract dotfile handling from Resource interface into its own domain. Keep existing state tracking, drift detection - just remove the shared abstraction layer.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:46:14.129906-07:00","updated_at":"2025-12-22T18:47:38.443417-07:00","closed_at":"2025-12-22T18:47:38.443417-07:00","close_reason":"Closed","dependencies":[{"issue_id":"plonk-5j8","depends_on_id":"plonk-8i4","type":"blocks","created_at":"2025-12-22T12:46:26.312556-07:00","created_by":"daemon"}]}
{"id":"plonk-5ns","title":"Implement hardcoded npm-family manager","description":"Create npm manager supporting provider swapping (npm/pnpm/bun). Single config option for which provider to use. Self-installation support for each provider.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:45:35.150044-07:00","updated_at":"2025-12-22T13:39:09.489859-07:00","closed_at":"2025-12-22T13:39:09.489859-07:00","close_reason":"Implemented NPMManager with npm/pnpm/bun provider swapping, provider-specific commands, JSON parsing, and self-install support.","dependencies":[{"issue_id":"plonk-5ns","depends_on_id":"plonk-yb6","type":"blocks","created_at":"2025-12-22T12:45:54.193958-07:00","created_by":"daemon"}]}
{"id":"plonk-6k7","title":"Upgrade tests don't verify actual version upgrades","description":"## Problem\nThe upgrade tests in `08-package-upgrade.bats` don't actually verify that upgrades work. They:\n1. Install a package\n2. Run `plonk upgrade \u003cpackage\u003e`\n3. Verify the package is still installed\n\nThis doesn't prove upgrading works - it only proves the command doesn't break an existing install.\n\n## Expected Behavior\nUpgrade tests should:\n1. Install a specific older version of a package (if package manager supports it)\n2. Record the installed version\n3. Run `plonk upgrade`\n4. Verify the version changed (or at least that the upgrade command actually invoked the package manager's upgrade)\n\n## Affected Tests\n- `upgrade single brew package`\n- `upgrade all brew packages`\n- `upgrade single npm package`\n- `upgrade all npm packages`\n- `upgrade single uv package`\n- `upgrade single gem package`\n- `upgrade single cargo package`\n- `upgrade single pipx package`\n- `upgrade single pnpm package`\n\n## Suggested Fix\nFor package managers that support version pinning:\n```bash\n# Install old version\nrun plonk install brew:cowsay@4.0  # or however versions work\n\n# Record version\nold_version=$(brew list --versions cowsay | awk '{print $2}')\n\n# Upgrade\nrun plonk upgrade brew:cowsay\n\n# Verify version changed (or is latest)\nnew_version=$(brew list --versions cowsay | awk '{print $2}')\nassert [ \"$new_version\" != \"$old_version\" ] || assert_output --partial \"already up-to-date\"\n```\n\nFor managers without version support, at minimum verify the upgrade command was actually invoked (not just silently passing).\n\n## Impact\nHigh - upgrade functionality could be completely broken and tests would still pass.\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T11:56:55.127823-07:00","updated_at":"2025-12-23T12:48:57.553014-07:00","closed_at":"2025-12-23T12:48:57.553014-07:00","close_reason":"Added version upgrade verification tests for npm and uv that actually install old versions and verify upgrade changes the version. Also cleaned up unsupported package manager references (pipx, pixi, conda) from test suite and added missing bun support to test helper."}
{"id":"plonk-6lt","title":"Review resources package post-refactor","description":"10 files with shared types. After Resource abstraction removal completes, assess remaining complexity.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:37:09.182393-07:00","updated_at":"2025-12-22T21:41:52.815604-07:00","closed_at":"2025-12-22T21:41:52.815604-07:00","close_reason":"Resources package was already deleted in commit fbadf22 - nothing to review"}
{"id":"plonk-720","title":"Audit and remove all config-driven package manager references","description":"Audit the entire codebase and remove ALL references to configuration-driven package managers including: comments mentioning config-driven managers, unused ManagerConfig fields/types, GetDefaultManagers() and related dead code, documentation references to YAML manager definitions, any test assertions that config-driven managers don't exist","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T15:03:20.295203-07:00","updated_at":"2025-12-22T15:21:36.426035-07:00","closed_at":"2025-12-22T15:21:36.426035-07:00","close_reason":"Removed: managers_defaults.go, GetDefaultManagers(), merge/diff functions from managers.go and user_defined.go, managers_test.go, adding-package-managers.md. Updated: architecture.md, code-map.md, README.md, CONTRIBUTING.md, configuration.md, reconcile.go, health.go"}
{"id":"plonk-77w","title":"Simplify UserDefinedChecker with reflection","description":"Replace 30-line manual switch in user_defined.go:85-106 with reflection-based field comparison. Could be 1 line instead of manual field enumeration.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T21:48:55.645081-07:00","updated_at":"2025-12-23T15:54:34.808567-07:00","closed_at":"2025-12-23T15:54:34.808567-07:00","close_reason":"Replaced manual switch with reflection-based field lookup"}
{"id":"plonk-7ke","title":"Remove .claude/settings.local.json from git tracking and add to .gitignore","description":"## Problem\n\n`.claude/settings.local.json` is currently tracked in git but contains user-specific settings (like allowed command permissions) that shouldn't be shared across environments.\n\n## Tasks\n\n1. Remove the file from git tracking with `git rm --cached`\n2. Add `.claude/settings.local.json` to `.gitignore`\n3. Commit both changes\n\n## Files\n- .gitignore\n- .claude/settings.local.json","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:20:48.61563-07:00","updated_at":"2025-12-23T11:21:51.346129-07:00","closed_at":"2025-12-23T11:21:51.346129-07:00","close_reason":"Removed from git tracking and added to .gitignore"}
{"id":"plonk-7tb","title":"Update BATS test documentation","description":"Update all documentation related to BATS tests with proper usage guidelines and safety warnings.\n\n## Key Documentation Requirements\n\n### Docker-First Execution\nDocument that all BATS tests **must** be run through `just docker-*` commands to ensure no accidental changes to the user's local environment.\n\n### Local Execution Warning\nAdd prominent warning that BATS tests should only be run locally if the user:\n- Is very sure they know what they are doing\n- Understands these tests can and will change their environment during the run\n- Accepts the risk of environment modifications\n\n### Coverage Areas\n- README or CONTRIBUTING docs\n- Test directory documentation\n- Any inline comments in justfile or test files\n- Developer onboarding documentation (if exists)\n\n## Workflow Note\nThis ticket can be worked in parallel with improvement tickets, but **requires a final review pass** once all other epic work is complete to ensure documentation reflects the final state of the test suite.\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:45:14.176699-07:00","updated_at":"2025-12-23T18:31:40.799259-07:00","closed_at":"2025-12-23T18:31:40.799259-07:00","close_reason":"Updated tests/bats/README.md with Docker-first approach, added BATS section to CONTRIBUTING.md, added warnings to justfile test-bats command"}
{"id":"plonk-7yv","title":"User manual testing (navigate and drive)","status":"deferred","priority":2,"issue_type":"task","created_at":"2025-12-22T13:41:20.04696-07:00","updated_at":"2025-12-22T20:56:54.509312-07:00","dependencies":[{"issue_id":"plonk-7yv","depends_on_id":"plonk-4gj","type":"blocks","created_at":"2025-12-22T13:41:24.936941-07:00","created_by":"daemon"},{"issue_id":"plonk-7yv","depends_on_id":"plonk-e49","type":"blocks","created_at":"2025-12-22T16:23:42.697615-07:00","created_by":"daemon"}]}
{"id":"plonk-7zy","title":"Inline lookupManagerMetadata and avoid double registry lookup","description":"lookupManagerMetadata() re-queries GetRegistry() when registry is already retrieved in checkPackageManagerHealth. Inline the metadata lookup.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T22:13:31.322116-07:00","updated_at":"2025-12-23T17:20:23.984412-07:00","closed_at":"2025-12-23T17:20:23.984412-07:00","close_reason":"Closed"}
{"id":"plonk-8a8","title":"Consolidate duplicate package manager test patterns","description":"## Problem\nPackage install, uninstall, and upgrade tests follow identical patterns for each manager (brew, npm, gem, cargo, uv, pnpm, pipx). This results in:\n- ~300 lines of near-duplicate code\n- Inconsistency when patterns diverge\n- More maintenance burden\n\n## Example Duplication\nEach of these files has nearly identical test structure per manager:\n- `03-package-install.bats`: ~180 lines, 11 tests\n- `04-package-uninstall.bats`: ~400 lines, 18 tests  \n- `08-package-upgrade.bats`: ~415 lines, 29 tests\n\n## Proposed Solution\nCreate a parameterized test helper that can run the same test logic across all package managers:\n\n```bash\n# lib/package_test_helper.bash\n\n# Run install test for a package manager\ntest_install_package() {\n  local manager=\"$1\"\n  local package=\"$2\"\n  \n  require_package_manager \"$manager\"\n  require_safe_package \"${manager}:${package}\"\n  \n  run plonk install \"${manager}:${package}\"\n  assert_success\n  assert_output --partial \"$package\"\n  assert_output --partial \"added\"\n  \n  track_artifact \"package\" \"${manager}:${package}\"\n  \n  # Verify actually installed (manager-specific)\n  verify_package_installed \"$manager\" \"$package\"\n  \n  # Verify in lock file\n  run cat \"$PLONK_DIR/plonk.lock\"\n  assert_output --partial \"$package\"\n}\n\n# Then in test file:\n@test \"install package - all managers\" {\n  test_install_package \"brew\" \"cowsay\"\n  test_install_package \"npm\" \"is-odd\"\n  test_install_package \"uv\" \"cowsay\"\n  # etc.\n}\n```\n\nOr use BATS load with dynamic test generation.\n\n## Files to Consolidate\n- `03-package-install.bats`\n- `04-package-uninstall.bats`\n- `08-package-upgrade.bats`\n\n## Estimated Reduction\nCould reduce ~1000 lines to ~300 lines while improving maintainability.\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:57:09.328495-07:00","updated_at":"2025-12-23T13:31:12.373258-07:00","closed_at":"2025-12-23T13:31:12.373258-07:00","close_reason":"Created package_test_helper.bash with centralized verification functions. Refactored 03-package-install.bats, 04-package-uninstall.bats, and 08-package-upgrade.bats to use helpers. Reduced total lines from 1188 to 974 (18% reduction) while improving maintainability."}
{"id":"plonk-8al","title":"Simplify orchestrator to domain glue","description":"Reduce orchestrator to: run package reconciliation, run dotfile reconciliation, report results. Remove Resource abstraction handling.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:46:14.287294-07:00","updated_at":"2025-12-22T18:58:03.198902-07:00","closed_at":"2025-12-22T18:58:03.198902-07:00","close_reason":"Already simplified - orchestrator only calls domain functions directly, no Resource interface handling","dependencies":[{"issue_id":"plonk-8al","depends_on_id":"plonk-r0i","type":"blocks","created_at":"2025-12-22T12:46:26.452117-07:00","created_by":"daemon"},{"issue_id":"plonk-8al","depends_on_id":"plonk-5j8","type":"blocks","created_at":"2025-12-22T12:46:26.543134-07:00","created_by":"daemon"}]}
{"id":"plonk-8ht","title":"Create standalone PNPMManager","description":"Extract pnpm-specific code from the combined npm.go into a standalone PNPMManager.\n\n**Scope:**\n- Create pnpm.go with PNPMManager\n- Use parseJSONDependencies(data, true) for ListInstalled (JSON array format)\n- Use 'add -g' for install, 'remove -g' for uninstall\n- SelfInstall needs 3-way fallback: brew→npm→curl script\n- ~80 lines estimated\n\n**Acceptance:**\n- PNPMManager works identically to current behavior\n- Tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:49:39.039093-07:00","updated_at":"2025-12-23T12:06:09.754238-07:00","closed_at":"2025-12-23T12:06:09.754238-07:00","close_reason":"Created standalone PNPMManager at pnpm.go (~90 lines) with 3-way install fallback (brew→npm→curl). Tests pass."}
{"id":"plonk-8i4","title":"Audit Resource interface and reconciliation engine","description":"Map current Resource interface, shared reconciliation code, orchestrator complexity. Identify what packages vs dotfiles actually need differently.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:46:13.813773-07:00","updated_at":"2025-12-22T16:30:39.856711-07:00","closed_at":"2025-12-22T16:30:39.856711-07:00","close_reason":"Audit complete. Resource interface unused by orchestrator. Recommendations documented for removal.","dependencies":[{"issue_id":"plonk-8i4","depends_on_id":"plonk-ard","type":"blocks","created_at":"2025-12-22T12:46:26.089549-07:00","created_by":"daemon"}],"comments":[{"id":1,"issue_id":"plonk-8i4","author":"rdh","text":"## Audit Findings\n\n### 1. Resource Interface (Unused by Orchestrator)\nImplementers: PackageResource, MultiPackageResource, DotfileResource\nKey finding: The orchestrator doesn't use this interface - calls packages.Apply() and dotfiles.Apply() directly.\n\n### 2. Shared Item Type (Over-generalized)\n- Kitchen-sink design - packages don't need Path, dotfiles don't need Manager\n- Metadata used as catch-all (version, source, destination, drift_comparator)\n- Domain field is redundant\n\n### 3. Shared Reconciliation (Partially Useful)\n- ReconcileItems() - dotfiles (name key)\n- ReconcileItemsWithKey() - packages (manager:name key)\n- ReconcileResource() - dotfiles only\n- GroupItemsByState() - useful for both\n- Drift detection runs for packages too (wasted cycles)\n\n### 4. Orchestrator (Already Thin)\nAlready bypasses Resource abstraction. Just needs cleanup.\n\n### 5. Recommendations\n1. Delete Resource interface - not used by orchestrator\n2. Delete PackageResource/DotfileResource adapters - dead code\n3. Keep shared ItemState enum, create domain-specific types\n4. Move reconciliation to domains\n5. Simplify orchestrator - remove unused lock field","created_at":"2025-12-22T23:30:13Z"}]}
{"id":"plonk-93j","title":"Review orchestrator coordination logic","description":"10 files coordinating apply operations. Assess if orchestration adds value or is over-engineered.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:37:08.641174-07:00","updated_at":"2025-12-22T22:03:15.324813-07:00","closed_at":"2025-12-22T22:03:15.324813-07:00","close_reason":"Reviewed: Only 4 production files (~217 lines), not over-engineered. Adds clear value for timeout management and result aggregation. Created plonk-d4x for type alias cleanup."}
{"id":"plonk-93l","title":"Move dotfiles from resources/dotfiles to dotfiles","description":"Move internal/resources/dotfiles to internal/dotfiles. Now that the shared Resource abstraction is removed, dotfiles can be a top-level internal package. Update all import paths accordingly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T19:05:20.724489-07:00","updated_at":"2025-12-22T19:19:49.471251-07:00","closed_at":"2025-12-22T19:19:49.471251-07:00","close_reason":"Closed"}
{"id":"plonk-97t","title":"Review packages package abstraction layers","description":"35 files with multiple package manager integrations. Assess if the abstraction layer is adding unnecessary complexity.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:37:08.285269-07:00","updated_at":"2025-12-22T21:59:38.513225-07:00","closed_at":"2025-12-22T21:59:38.513225-07:00","close_reason":"Review complete. Core abstractions appropriate but significant duplication across 6 managers. Created 6 follow-ups: plonk-4s9 (P2: BaseManager extraction), plonk-pmv (P2: consolidate 7 parsers), plonk-ed0 (P3: SelfInstall patterns), plonk-x40 (P3: Apply DI), plonk-54z (P3: uninstall complexity), plonk-ynr (P4: operations loops)."}
{"id":"plonk-9c3","title":"Update orchestrator to use domain-specific types","description":"Update orchestrator/reconcile.go to handle domain-specific result types from packages and dotfiles instead of resources.Result.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T19:26:02.831269-07:00","updated_at":"2025-12-22T20:03:57.180487-07:00","closed_at":"2025-12-22T20:03:57.180487-07:00","close_reason":"Closed","dependencies":[{"issue_id":"plonk-9c3","depends_on_id":"plonk-nal","type":"blocks","created_at":"2025-12-22T19:26:14.293253-07:00","created_by":"daemon"},{"issue_id":"plonk-9c3","depends_on_id":"plonk-463","type":"blocks","created_at":"2025-12-22T19:26:14.383588-07:00","created_by":"daemon"}]}
{"id":"plonk-adu","title":"Implement hardcoded go manager","description":"Create dedicated go manager for 'go install' packages. Self-installation strategy TBD (brew? official installer?).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:45:35.476804-07:00","updated_at":"2025-12-22T13:31:01.17031-07:00","closed_at":"2025-12-22T13:31:01.17031-07:00","close_reason":"Implemented GoManager with GOBIN scanning for list, binary removal for uninstall, and brew-based self-install.","dependencies":[{"issue_id":"plonk-adu","depends_on_id":"plonk-yb6","type":"blocks","created_at":"2025-12-22T12:45:54.376621-07:00","created_by":"daemon"}]}
{"id":"plonk-ard","title":"Remove config-driven package managers","description":"Kill GenericManager and YAML-based manager configuration. Hardcode support for: brew, npm-family (with provider swapping for pnpm/bun), cargo, go, uv. Restore self-installation support with ability to configure bootstrap method per manager.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T12:43:57.022259-07:00","updated_at":"2025-12-22T16:18:34.137122-07:00","closed_at":"2025-12-22T16:18:34.137122-07:00","close_reason":"All hardcoded managers implemented with SelfInstall support. AGENTS.md updated to reflect new architecture.","dependencies":[{"issue_id":"plonk-ard","depends_on_id":"plonk-4ll","type":"blocks","created_at":"2025-12-22T12:45:59.990859-07:00","created_by":"daemon"}]}
{"id":"plonk-arp","title":"Review npm/pnpm/bun package implementations for unnecessary complexity","description":"Review the npm, pnpm, and bun package manager implementations. These may be set up differently than other packages, potentially causing unnecessary complexity.\n\n**Deliverable**: Create additional beads to address any issues found, OR document why the current implementation is justified.\n\n**Scope**:\n- Compare implementation patterns across all package managers\n- Identify any unnecessary divergence from common patterns\n- Evaluate if complexity is warranted by functional requirements","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:25:49.707207-07:00","updated_at":"2025-12-23T11:50:09.218961-07:00","closed_at":"2025-12-23T11:50:09.218961-07:00","close_reason":"Review complete. Created 4 follow-up tasks to split npm.go into 3 standalone managers (npm, pnpm, bun) matching the pattern of other package managers. See: plonk-rtw, plonk-8ht, plonk-sy9, plonk-1bg","comments":[{"id":2,"issue_id":"plonk-arp","author":"rdh","text":"Intent clarification: The npm manager should be split into 3 separate managers (npm, pnpm, bun) to match the pattern of other package managers. Re-analyze with this goal in mind.","created_at":"2025-12-23T18:48:47Z"}]}
{"id":"plonk-az0","title":"Extract lock file parsing helper to avoid duplicate iteration","description":"Lock file resources iterated twice: in checkLockFileValidity and collectRequiredManagers. Extract helper to parse once and return structured data.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T22:13:31.499089-07:00","updated_at":"2025-12-23T17:24:14.200871-07:00","closed_at":"2025-12-23T17:24:14.200871-07:00","close_reason":"Closed"}
{"id":"plonk-b85","title":"Delete operations package","description":"After domain-specific operation result types are in place, delete internal/operations package entirely to complete the removal of shared abstractions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:49:48.9274-07:00","updated_at":"2025-12-22T21:39:01.106942-07:00","closed_at":"2025-12-22T21:39:01.106942-07:00","close_reason":"Deleted internal/operations package - no longer used after domain-specific types were implemented","dependencies":[{"issue_id":"plonk-b85","depends_on_id":"plonk-c8t","type":"blocks","created_at":"2025-12-22T20:49:53.780569-07:00","created_by":"daemon"},{"issue_id":"plonk-b85","depends_on_id":"plonk-0na","type":"blocks","created_at":"2025-12-22T20:49:53.873443-07:00","created_by":"daemon"}]}
{"id":"plonk-bl6","title":"Consolidate duplicate spinner/progress indicator tests","description":"## Problem\nSpinner and progress indicator tests are duplicated across multiple files with nearly identical assertions:\n\n### Files with Spinner Tests\n- `03-package-install.bats`: 3 spinner tests\n- `04-package-uninstall.bats`: 4 spinner tests  \n- `07-apply-behavior.bats`: 4 spinner tests\n- `08-package-upgrade.bats`: 2 spinner tests\n\n### Example Duplication\n```bash\n# These tests appear in multiple files with minor variations:\n@test \"X shows spinner during operation\" {\n  # setup...\n  run plonk X ...\n  assert_success\n  assert_output --partial \"Xing\"\n  assert_output --partial \"✓\"\n}\n\n@test \"X shows progress indicators for multiple operations\" {\n  # setup...\n  run plonk X ...\n  assert_success\n  assert_output --partial \"[1/2]\"\n  assert_output --partial \"[2/2]\"\n}\n```\n\n## Proposed Solution\n1. Create a dedicated `11-spinner-and-progress.bats` file\n2. Consolidate all spinner/progress tests there\n3. Test the UI behavior once per command rather than per-manager\n\n```bash\n# 11-spinner-and-progress.bats\n@test \"all commands show spinners during single operations\" {\n  # Test one representative from each command type\n  test_spinner_install\n  test_spinner_uninstall\n  test_spinner_upgrade\n  test_spinner_apply\n}\n\n@test \"all commands show progress indicators for batch operations\" {\n  # Test progress with multiple items\n  test_progress_install_multiple\n  test_progress_uninstall_multiple\n}\n```\n\n## Estimated Reduction\n~50 lines of duplicate code, plus better test organization.\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:57:20.834614-07:00","updated_at":"2025-12-23T14:02:52.74144-07:00","closed_at":"2025-12-23T14:02:52.74144-07:00","close_reason":"Consolidated 11 spinner/progress tests from 3 files into new 11-spinner-and-progress.bats"}
{"id":"plonk-bs9","title":"Update commands to use domain-specific types","description":"Update status.go, diff.go, and other commands to use domain-specific types instead of resources.Item/Result.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T19:26:03.03159-07:00","updated_at":"2025-12-22T20:12:24.730828-07:00","closed_at":"2025-12-22T20:12:24.730828-07:00","close_reason":"Closed","dependencies":[{"issue_id":"plonk-bs9","depends_on_id":"plonk-9c3","type":"blocks","created_at":"2025-12-22T19:26:14.52524-07:00","created_by":"daemon"}]}
{"id":"plonk-c1a","title":"Create dotfiles-specific Item type","description":"Create DotfileItem type in internal/dotfiles to replace resources.Item usage. Include source, destination, state, and drift metadata.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T19:26:02.349034-07:00","updated_at":"2025-12-22T19:45:36.021456-07:00","closed_at":"2025-12-22T19:45:36.021456-07:00","close_reason":"Closed"}
{"id":"plonk-c8t","title":"Define dotfiles-specific operation result types","description":"Move operations.Result usage in dotfiles to domain-specific types. AddFiles/RemoveFiles should return dotfiles.OperationResult or similar, not a shared type. Convert to output types at the commands boundary.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:48:57.534735-07:00","updated_at":"2025-12-22T21:05:46.141895-07:00","closed_at":"2025-12-22T21:05:46.141895-07:00","close_reason":"Implemented domain-specific result types for dotfiles operations"}
{"id":"plonk-cc7","title":"Fix diff command source path resolution","description":"## Root Cause\n\nIn `internal/commands/diff.go:79-88`, the diff command uses `item.Source` directly without prepending the config directory:\n\n```go\nsourcePath := item.Source  // e.g., \"plonk-test-diff-order\" (relative)\nif sourcePath == \"\" {\n    // Only prepends configDir if Source is empty\n    sourcePath = filepath.Join(configDir, sourceName)\n}\n```\n\nBut `item.Source` from `GetConfiguredDotfiles` is a relative path (e.g., \"vimrc\"), not an absolute path. The fallback logic only applies when Source is empty, not when it's a relative path.\n\n## Impact\n\nThe diff command passes a relative path to `git diff --no-index`, which fails with:\n`error: Could not access 'plonk-test-diff-order'`\n\n## Fix\n\nAlways construct the full path using configDir:\n```go\nsourcePath := filepath.Join(configDir, item.Source)\n```\n\nOr check if the path is absolute before using it directly.\n\n## Affected Tests (10-drift-and-sync.bats)\n- \"diff shows $HOME on left and $PLONK_DIR on right\"\n\n## Files\n- internal/commands/diff.go:79-88","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T10:44:25.409255-07:00","updated_at":"2025-12-23T11:00:26.017358-07:00","closed_at":"2025-12-23T11:00:26.017358-07:00","close_reason":"Fixed by adding filepath.IsAbs check for relative source paths"}
{"id":"plonk-cqk","title":"Identify simplification refactors after config-driven manager removal","description":"Audit the codebase for simplification opportunities now that config-driven package managers are removed: Config struct fields that are no longer needed (Managers field), merge functions that are no longer used, validator logic that can be simplified, types like ManagerConfig/ListConfig/CommandConfig that may be removable, any abstraction layers that existed only to support config-driven managers","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T15:03:20.44769-07:00","updated_at":"2025-12-22T15:37:04.391918-07:00","closed_at":"2025-12-22T15:37:04.391918-07:00","close_reason":"Removed: Config.Managers field, ManagerConfig/ListConfig/CommandConfig types (managers.go), listconfig validator, GetNonDefaultManagers(), diff functions from user_defined.go. Simplified: config_formatter.go, config_edit.go, health.go. Updated tests to not use config-driven managers."}
{"id":"plonk-d4x","title":"Remove type aliases from orchestrator/types.go","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T22:00:37.401016-07:00","updated_at":"2025-12-23T17:16:18.816605-07:00","closed_at":"2025-12-23T17:16:18.816605-07:00","close_reason":"Closed"}
{"id":"plonk-e49","title":"Remove shared Resource abstraction","description":"Kill the unified Resource interface and shared reconciliation engine. Implement domain-specific reconciliation: packages get simple list-based reconciliation, dotfiles keep their own state tracking. Orchestrator becomes trivial glue between the two domains.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T12:44:00.791249-07:00","updated_at":"2025-12-22T20:50:02.422895-07:00","closed_at":"2025-12-22T20:50:02.422895-07:00","close_reason":"Partial completion: removed resources package but created operations package which shifts coupling rather than eliminates it. Follow-up work in plonk-c8t, plonk-0na, plonk-b85 to move operation result types to domain-specific packages and delete operations package.","dependencies":[{"issue_id":"plonk-e49","depends_on_id":"plonk-ard","type":"blocks","created_at":"2025-12-22T12:44:15.050363-07:00","created_by":"daemon"},{"issue_id":"plonk-e49","depends_on_id":"plonk-i2j","type":"blocks","created_at":"2025-12-22T12:46:26.860332-07:00","created_by":"daemon"},{"issue_id":"plonk-e49","depends_on_id":"plonk-fzu","type":"blocks","created_at":"2025-12-22T19:06:20.139583-07:00","created_by":"daemon"},{"issue_id":"plonk-e49","depends_on_id":"plonk-93l","type":"blocks","created_at":"2025-12-22T19:06:20.232143-07:00","created_by":"daemon"},{"issue_id":"plonk-e49","depends_on_id":"plonk-qu5","type":"blocks","created_at":"2025-12-22T19:20:54.54061-07:00","created_by":"daemon"}]}
{"id":"plonk-ed0","title":"Consolidate SelfInstall patterns across package managers","description":"Each manager implements own try-brew-first-then-fallback pattern for SelfInstall. Extract into shared template with manager-specific configuration.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T21:59:01.319898-07:00","updated_at":"2025-12-23T13:06:09.472883-07:00","closed_at":"2025-12-23T13:06:09.472883-07:00","close_reason":"Consolidated SelfInstall patterns: npm.go, gem.go, and pnpm.go now use SelfInstallWithBrewFallback helper","comments":[{"id":3,"issue_id":"plonk-ed0","author":"rdh","text":"Need to fix pnpm.go to use SelfInstallWithBrewFallback instead of custom 3-way fallback (brew→npm→curl). User clarified pnpm is not special - should use standard brew→curl pattern like others.","created_at":"2025-12-23T20:03:28Z"}]}
{"id":"plonk-fcx","title":"Extract file validation helper in diagnostics","description":"Same file read + status check pattern repeated in checkConfigurationFile, checkLockFile, and 2 other functions. Create checkFileReadable() helper. ~40 lines saved.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T22:13:30.807014-07:00","updated_at":"2025-12-23T16:47:36.747121-07:00","closed_at":"2025-12-23T16:47:36.747121-07:00","close_reason":"Added checkFileStatus helper, refactored checkConfigurationFile and checkLockFile to use it"}
{"id":"plonk-fzu","title":"Move packages from resources/packages to packages","description":"Move internal/resources/packages to internal/packages. Now that the shared Resource abstraction is removed, packages can be a top-level internal package. Update all import paths accordingly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T19:05:20.583429-07:00","updated_at":"2025-12-22T19:11:46.867824-07:00","closed_at":"2025-12-22T19:11:46.867824-07:00","close_reason":"Closed"}
{"id":"plonk-ghl","title":"Fix BATS test failures in drift/sync and template tests","description":"INVESTIGATION COMPLETE - See child issues for fixes\n\n## Summary of Findings\n\nAnalyzed 12 BATS test failures across two test files. Root causes identified and documented in follow-up issues.\n\n### 10-drift-and-sync.bats (6 failures)\n\n**Bug 1: Drift state conversion** (plonk-l91)\n- `dotfiles.go:87` converts StateDegraded to \"degraded\" instead of \"drifted\"\n- Causes drift detection to always show \"deployed\" instead of \"drifted\"\n- Affects: 3 tests\n\n**Bug 2: Diff source path resolution** (plonk-cc7)\n- `diff.go:79-88` uses relative Source path without prepending configDir\n- Causes git diff to fail with \"Could not access\" error\n- Affects: 1 test\n\n**Bug 3: Selective apply path lookup** (plonk-uz2)\n- `apply.go:154-169` looks for Metadata[\"destination\"] but it's not set\n- GetConfiguredDotfiles sets Destination field, not Metadata\n- Causes \"file not managed\" error for valid managed files\n- Affects: 3 tests\n\n### 18-dotfile-templates.bats (6 failures)\n\nTemplate failures are likely cascading from the drift detection bug (Bug 1). Once drift detection is fixed, template tests should be re-evaluated.\n\n## Follow-up Issues Created\n\n1. plonk-l91: Fix drift state conversion (P1)\n2. plonk-cc7: Fix diff command source path resolution (P1)\n3. plonk-uz2: Fix selective apply path lookup (P1)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T10:36:09.303517-07:00","updated_at":"2025-12-23T11:18:42.024323-07:00","closed_at":"2025-12-23T11:18:42.024323-07:00","close_reason":"All child issues fixed: drift state conversion, diff path resolution, and selective apply","dependencies":[{"issue_id":"plonk-ghl","depends_on_id":"plonk-l91","type":"blocks","created_at":"2025-12-23T10:44:55.473934-07:00","created_by":"daemon"},{"issue_id":"plonk-ghl","depends_on_id":"plonk-cc7","type":"blocks","created_at":"2025-12-23T10:44:55.565147-07:00","created_by":"daemon"},{"issue_id":"plonk-ghl","depends_on_id":"plonk-uz2","type":"blocks","created_at":"2025-12-23T10:44:55.656135-07:00","created_by":"daemon"}]}
{"id":"plonk-hnh","title":"Add deeper validation assertions to shallow tests","description":"## Problem\nMany tests perform shallow validations that could miss real failures:\n\n### Example 1: String-only checks\n```bash\nrun plonk install brew:cowsay\nassert_success\nassert_output --partial \"cowsay\"  # Just checks string appeared\n```\nThis could pass if plonk printed \"Failed to install cowsay\" - the word appears!\n\n### Example 2: Missing system state verification\nSome tests check plonk's output but not the actual system state:\n```bash\nrun plonk uninstall brew:figlet\nassert_success\nassert_output --partial \"removed\"\n# Missing: run brew list figlet \u0026\u0026 assert_failure\n```\n\n### Example 3: Spinner tests without behavior check\n```bash\n@test \"install shows spinner during operation\" {\n  run plonk install brew:cowsay\n  assert_output --partial \"Installing\"\n  assert_output --partial \"✓\"\n  # Doesn't verify package was actually installed\n}\n```\n\n## Proposed Improvements\n\n### 1. Use more specific assertions\n```bash\n# Instead of:\nassert_output --partial \"added\"\n\n# Use:\nassert_output --partial \"✓ added\"  # More specific\n# Or check explicit status messages\n```\n\n### 2. Always verify system state for install/uninstall\n```bash\n# After install:\nrun brew list cowsay\nassert_success \"Package should be installed on system\"\n\n# After uninstall:\nrun brew list cowsay\nassert_failure \"Package should be removed from system\"\n```\n\n### 3. Add custom assertions for common patterns\n```bash\n# lib/assertions.bash\nassert_package_installed() {\n  local manager=\"$1\"\n  local package=\"$2\"\n  # Manager-specific verification\n}\n\nassert_package_not_installed() {\n  local manager=\"$1\"  \n  local package=\"$2\"\n  # Manager-specific verification\n}\n```\n\n## Files Needing Review\n- `03-package-install.bats` - Add system verification to all install tests\n- `04-package-uninstall.bats` - Some tests already good, standardize all\n- `07-apply-behavior.bats` - Add state verification\n- `08-package-upgrade.bats` - Major overhaul needed (see separate ticket)\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:00:07.000564-07:00","updated_at":"2025-12-23T15:16:28.560936-07:00","closed_at":"2025-12-23T15:16:28.560936-07:00","close_reason":"Added system state verification to 9 shallow tests in spinner and uninstall test files"}
{"id":"plonk-i2j","title":"Update reconciliation tests","description":"Update tests for new domain-specific reconciliation. Remove tests for deleted Resource abstraction.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:46:14.644771-07:00","updated_at":"2025-12-22T19:03:22.293553-07:00","closed_at":"2025-12-22T19:03:22.293553-07:00","close_reason":"Tests already updated in first commit - resource_test.go deleted, drift_apply_test.go updated","dependencies":[{"issue_id":"plonk-i2j","depends_on_id":"plonk-0cw","type":"blocks","created_at":"2025-12-22T12:46:26.769426-07:00","created_by":"daemon"}]}
{"id":"plonk-ihz","title":"Consolidate help command tests into dedicated file","description":"## Problem\nHelp command tests are scattered across many files:\n\n### Current Distribution\n| File | Help Tests |\n|------|------------|\n| `00-smoke.bats` | \"plonk help command works\" |\n| `01-basic-commands.bats` | \"help for specific command works\" |\n| `13-clone-command.bats` | None (missing) |\n| `14-doctor-command.bats` | \"doctor --help shows usage\", \"doctor help via plonk help doctor\" |\n| `15-config-show.bats` | \"config show --help shows usage\", \"plonk help config shows subcommands\" |\n\n### Inconsistent Coverage\nNot all commands have help tests:\n- Missing: clone --help, add --help, rm --help, apply --help, upgrade --help, etc.\n\n## Proposed Solution\nCreate `17-help-system.bats` with comprehensive help tests:\n\n```bash\n# Test all commands have --help\n@test \"all commands support --help flag\" {\n  local commands=(install uninstall upgrade add rm apply status packages dotfiles diff clone doctor config)\n  \n  for cmd in \"${commands[@]}\"; do\n    run plonk \"$cmd\" --help\n    assert_success\n    assert_output --partial \"Usage:\"\n  done\n}\n\n# Test plonk help \u003ccommand\u003e syntax\n@test \"plonk help \u003ccommand\u003e works for all commands\" {\n  local commands=(install uninstall upgrade add rm apply status)\n  \n  for cmd in \"${commands[@]}\"; do\n    run plonk help \"$cmd\"\n    assert_success\n    assert_output --partial \"$cmd\"\n  done\n}\n\n# Test help output quality\n@test \"help output includes examples\" {\n  run plonk help install\n  assert_output --partial \"Examples:\"\n}\n```\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T12:00:47.132416-07:00","updated_at":"2025-12-23T15:29:51.83108-07:00","closed_at":"2025-12-23T15:29:51.83108-07:00","close_reason":"Won't fix - testing help output is pointless"}
{"id":"plonk-iug","title":"Review diagnostics package","description":"9 files for health checks and system diagnostics. Assess if checks are necessary or over-engineered.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:37:09.003013-07:00","updated_at":"2025-12-22T22:13:48.24584-07:00","closed_at":"2025-12-22T22:13:48.24584-07:00","close_reason":"Review complete. Package has 34% boilerplate duplication. Created 5 follow-ups: plonk-fcx (P3: file validation helper), plonk-xlh (P3: HealthCheck builder), plonk-kt6 (P3: structured template errors), plonk-7zy (P4: inline registry lookup), plonk-az0 (P4: lock parsing helper). Potential 20% reduction."}
{"id":"plonk-jkg","title":"Remove dead code from config package","description":"Remove unused code: ResolvedConfig type alias, GetConfigDir() wrapper (just use GetDefaultConfigDirectory), and possibly Load()/LoadFromPath() if only LoadWithDefaults is used.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T21:48:55.333358-07:00","updated_at":"2025-12-22T22:20:33.902831-07:00","closed_at":"2025-12-22T22:20:33.902831-07:00","close_reason":"Removed ResolvedConfig type alias (changed GetDefaults return type to *Config) and GetConfigDir wrapper (replaced all 20 call sites with GetDefaultConfigDirectory). Load/LoadFromPath are still in use and were kept."}
{"id":"plonk-kt6","title":"Use structured template errors instead of string parsing","description":"extractVarNameFromError() parses error strings like 'requires variable X which is not defined'. Fragile. dotfiles.ValidateTemplate() should return ValidationError{VarName: string} instead.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T22:13:31.145818-07:00","updated_at":"2025-12-23T16:58:10.485697-07:00","closed_at":"2025-12-23T16:58:10.485697-07:00","close_reason":"Closed"}
{"id":"plonk-l91","title":"Fix drift state conversion: 'degraded' should be 'drifted'","description":"## Root Cause\n\nIn `internal/commands/dotfiles.go:87`, the conversion from `dotfiles.ItemState` to `output.ItemState` uses wrong value:\n\n```go\ncase dotfiles.StateDegraded:\n    state = output.ItemState(\"degraded\")  // BUG: Should be \"drifted\"\n```\n\nThe output package defines `StateDegraded = \"drifted\"` but the conversion sets it to \"degraded\".\n\n## Impact\n\nThe dotfiles status formatter checks `item.State == StateDegraded` (which equals \"drifted\"), but the actual state is \"degraded\", so the comparison NEVER matches. This causes ALL drifted files to show as \"deployed\" instead of \"drifted\".\n\n## Fix\n\nChange line 87 in `internal/commands/dotfiles.go`:\n```go\ncase dotfiles.StateDegraded:\n    state = output.ItemState(\"drifted\")  // or use output.StateDegraded constant\n```\n\n## Affected Tests (10-drift-and-sync.bats)\n- \"status does not show drifted dotfiles twice\"\n- \"plonk add -y syncs drifted files back to $PLONK_DIR\" \n- \"complete workflow: drift, check status, sync back, apply selectively\"\n\n## Files\n- internal/commands/dotfiles.go:87","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T10:44:17.03839-07:00","updated_at":"2025-12-23T10:55:36.415166-07:00","closed_at":"2025-12-23T10:55:36.415166-07:00","close_reason":"Fixed state conversion to use output.StateDegraded constant"}
{"id":"plonk-ms5","title":"Remove or relocate test-go-debug.bats","description":"## Problem\n`tests/bats/test-go-debug.bats` appears to be a development/debugging file that shouldn't be in the main test suite:\n\n```bash\n@test \"debug go install\" {\n  setup_test_env\n  echo \"# PLONK_DIR: $PLONK_DIR\" \u003e\u00263\n  echo \"# PATH: $PATH\" \u003e\u00263\n  echo \"# Which plonk: $(which plonk)\" \u003e\u00263\n  # ... debugging output\n}\n```\n\nThis test:\n- Only prints debug information\n- Doesn't assert anything meaningful\n- Runs every time the full suite runs\n- Adds to test runtime unnecessarily\n\n## Proposed Solutions\n\n### Option A: Delete the file\nIf it's no longer needed for debugging, simply remove it.\n\n### Option B: Move to debug/ directory\n```\ntests/bats/\n├── behavioral/\n├── cleanup/\n├── debug/              # New directory\n│   └── go-debug.bats   # Moved here\n└── lib/\n```\n\nUpdate docker-compose or test runner to exclude `debug/` from normal runs.\n\n### Option C: Convert to skip-by-default\n```bash\n@test \"debug go install\" {\n  skip \"Debug test - run manually when needed\"\n  # ... existing code\n}\n```\n\n## Recommendation\nOption A (delete) unless there's active need for this debugging capability. The information it outputs can be easily obtained with `echo` statements added temporarily when debugging.\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T12:01:19.817366-07:00","updated_at":"2025-12-23T17:12:31.9484-07:00","closed_at":"2025-12-23T17:12:31.9484-07:00","close_reason":"Completed in previous commit (4f7b0cc)"}
{"id":"plonk-nal","title":"Update dotfiles reconciliation to use domain types","description":"Update dotfiles reconcile.go and apply.go to use DotfileItem instead of resources.Item. Inline or copy the reconciliation algorithm.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T19:26:02.506976-07:00","updated_at":"2025-12-22T19:55:54.427734-07:00","closed_at":"2025-12-22T19:55:54.427734-07:00","close_reason":"Closed","dependencies":[{"issue_id":"plonk-nal","depends_on_id":"plonk-c1a","type":"blocks","created_at":"2025-12-22T19:26:14.151348-07:00","created_by":"daemon"}]}
{"id":"plonk-nc5","title":"Externalize hardcoded filter patterns in config","description":"Move 72 hardcoded ignore/unmanaged patterns from config.go:40-143 to external YAML file. Reduces cognitive load and makes patterns easier to maintain.","status":"deferred","priority":2,"issue_type":"task","created_at":"2025-12-22T21:48:55.180032-07:00","updated_at":"2025-12-23T10:04:27.67311-07:00"}
{"id":"plonk-orj","title":"Implement hardcoded uv manager","description":"Create dedicated uv manager. Self-installation via brew or official script. Handle uv tool install semantics.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:45:35.647589-07:00","updated_at":"2025-12-22T13:33:53.062002-07:00","closed_at":"2025-12-22T13:33:53.062002-07:00","close_reason":"Implemented UVManager with uv tool commands, upgrade-all support, and brew/script self-install.","dependencies":[{"issue_id":"plonk-orj","depends_on_id":"plonk-yb6","type":"blocks","created_at":"2025-12-22T12:45:54.468602-07:00","created_by":"daemon"}]}
{"id":"plonk-p55","title":"Consolidate result validation patterns in commands package","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T21:55:08.708522-07:00","updated_at":"2025-12-23T17:41:18.822311-07:00","closed_at":"2025-12-23T17:41:18.822311-07:00","close_reason":"Consolidated result validation patterns by extracting ValidateBatchResults helper function. Reduced 4 duplicate 19-line functions to 4 concise 3-line wrappers."}
{"id":"plonk-pmv","title":"Consolidate 7 parsing functions into configurable parser","description":"parseLines, parseCargoList, parseGemList, parseNPMJSON, parsePNPMJSON, parseBunList, parseUVList all do similar work returning []string. Create ParseConfig struct with single implementation. ~200 lines saved.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T21:59:01.16344-07:00","updated_at":"2025-12-23T11:29:39.049533-07:00","closed_at":"2025-12-23T11:29:39.049533-07:00","close_reason":"Consolidated 7 parsing functions into 2 configurable parsers (parseOutput, parseJSONDependencies). 79 net lines saved."}
{"id":"plonk-q39","title":"Review output package for consolidation opportunities","description":"34 files of formatting logic. Assess if output modes, formatters, and styling can be simplified or consolidated.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:37:07.929684-07:00","updated_at":"2025-12-22T21:44:52.162452-07:00","closed_at":"2025-12-22T21:44:52.162452-07:00","close_reason":"Reviewed: 17 production files, well-architected with consistent patterns. No consolidation needed - complexity serves real CLI output requirements."}
{"id":"plonk-qu5","title":"Remove resources package","description":"Delete internal/resources/ entirely. After moving packages and dotfiles to top-level internal packages, the shared resources package should be unused.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T19:20:47.37599-07:00","updated_at":"2025-12-22T20:44:50.099125-07:00","closed_at":"2025-12-22T20:44:50.099125-07:00","close_reason":"Removed internal/resources package entirely. Created operations package for shared operation types (Result, Summary, CalculateSummary, ValidateResults). Updated all usages across dotfiles, packages, commands, and orchestrator packages. Updated documentation.","dependencies":[{"issue_id":"plonk-qu5","depends_on_id":"plonk-2cl","type":"blocks","created_at":"2025-12-22T19:26:14.808167-07:00","created_by":"daemon"}]}
{"id":"plonk-r0i","title":"Implement simple package reconciliation","description":"Replace Resource-based package handling with simple list-based reconciliation: diff lock file specs against installed packages, install/remove as needed. No shared abstractions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:46:13.974179-07:00","updated_at":"2025-12-22T17:16:45.457282-07:00","closed_at":"2025-12-22T17:16:45.457282-07:00","close_reason":"Implemented simple list-based package reconciliation. Added PackageSpec.Key(), Reconcile(), ReconcileFromLock(), GetDesiredFromLock(), GetActualInstalled(). Updated Apply to use new reconciliation. Deleted unused resource.go (PackageResource/MultiPackageResource).","dependencies":[{"issue_id":"plonk-r0i","depends_on_id":"plonk-8i4","type":"blocks","created_at":"2025-12-22T12:46:26.221297-07:00","created_by":"daemon"}]}
{"id":"plonk-rtw","title":"Create standalone NPMManager (npm only)","description":"Extract npm-specific code from the combined npm.go into a standalone NPMManager that follows the same pattern as brew.go, cargo.go, etc.\n\n**Scope:**\n- Create npm.go with just NPMManager (no provider field)\n- Use parseJSONDependencies(data, false) for ListInstalled\n- Use RunIdempotent for Install/Uninstall\n- Keep SelfInstall logic for npm (brew install node, then error)\n- ~70 lines estimated\n\n**Acceptance:**\n- NPMManager works identically to current behavior\n- Tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:49:38.878066-07:00","updated_at":"2025-12-23T12:01:28.515288-07:00","closed_at":"2025-12-23T12:01:28.515288-07:00","close_reason":"Created standalone NPMManager at npm.go (~80 lines) following the same pattern as brew.go, cargo.go, etc. Legacy implementation preserved in npm_legacy.go for pnpm/bun until those tasks are completed."}
{"id":"plonk-sy9","title":"Create standalone BunManager","description":"Extract bun-specific code from the combined npm.go into a standalone BunManager.\n\n**Scope:**\n- Create bun.go with BunManager\n- Use parseOutput for ListInstalled (text format with SkipPrefixes)\n- Use 'add -g' for install, 'remove -g' for uninstall\n- Upgrade uses 'add -g pkg@latest' (no upgrade-all support)\n- SelfInstall: brew→curl script (can use SelfInstallWithBrewFallback)\n- ~70 lines estimated\n\n**Acceptance:**\n- BunManager works identically to current behavior\n- Tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:49:39.201471-07:00","updated_at":"2025-12-23T12:13:31.433155-07:00","closed_at":"2025-12-23T12:13:31.433155-07:00","close_reason":"Created standalone BunManager at bun.go (~70 lines) using SelfInstallWithBrewFallback. Tests pass."}
{"id":"plonk-t3n","title":"Evaluate parallelization opportunities for improved BATS suite","description":"Evaluate opportunities to parallelize the improved/consolidated BATS test suite to reduce runtime.\n\n## Analysis Results\n\n### Current State\n- **Total tests**: 203\n- **Total runtime**: ~5 minutes (4:58)\n- **Test files**: 17 behavioral + 1 cleanup\n\n### Slowest Tests (Top 5)\n1. upgrade single cargo package: 21s\n2. install cargo package: 12.5s  \n3. apply shows progress indicators: 10s\n4. install multiple brew packages: 8s\n5. upgrade all brew packages: 7s\n\n### Key Constraint: Shared Package Manager State\nPackage managers (brew, npm, cargo, etc.) are GLOBAL within the Docker container.\nTests that install/uninstall the SAME package cannot run in parallel.\n\nPackage usage across files:\n- brew:cowsay - used in 10 files (91 references)\n- brew:figlet - used in 7 files (62 references)  \n- npm:is-odd - used in 6 files (14 references)\n\n### Parallelization Groups\n\n**Group A - Safe to parallelize (no package mutations)**:\n- 01-basic-commands.bats\n- 04-dotfile-add.bats\n- 05-dotfile-rm.bats\n- 09-drift-and-sync.bats\n- 11-clone-command.bats\n- 13-config-show.bats\n- 16-dotfile-templates.bats\nTotal: 64 tests, ~20s sequential, ~16s parallel\n\n**Group B - Must serialize (shared package state)**:\n- 00-smoke.bats, 02-package-install.bats, 03-package-uninstall.bats\n- 06-apply-behavior.bats, 07-package-upgrade.bats, 08-error-scenarios.bats\n- 10-spinner-and-progress.bats, 12-doctor-command.bats\n- 14-command-aliases.bats, 15-dry-run-behavior.bats\nTotal: 139 tests, ~4:30\n\n### Recommendations\n\n**1. Immediate Win: Two-Phase Execution (Low Effort, ~15-20% improvement)**\nRun dotfile tests in parallel (-j 4), package tests sequentially.\n\n**2. Future: Container-Level Parallelization (High Effort, 50-70% potential)**\nRun test files in separate Docker containers for true isolation.\n\n**3. Alternative: Package Isolation (Medium Effort)**\nAssign unique safe packages per test file. Requires expanding safe-packages.list.\n\n### Conclusion\nLimited parallelization benefit (~15-20%) achievable with current structure due to shared package manager state. Cargo compilation is the single biggest bottleneck (21s for one test). True parallelization requires container-level isolation - significant infrastructure change for modest gains.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:45:05.194322-07:00","updated_at":"2025-12-23T18:28:11.332518-07:00","closed_at":"2025-12-23T18:28:11.332518-07:00","close_reason":"Analysis complete. ~15-20% improvement possible via two-phase execution. Further gains require container-level isolation (high effort). See description for full details.","dependencies":[{"issue_id":"plonk-t3n","depends_on_id":"plonk-2iq","type":"blocks","created_at":"2025-12-23T11:45:21.225702-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-6k7","type":"blocks","created_at":"2025-12-23T12:01:27.408717-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-8a8","type":"blocks","created_at":"2025-12-23T12:01:27.501498-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-bl6","type":"blocks","created_at":"2025-12-23T12:01:27.593105-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-t8k","type":"blocks","created_at":"2025-12-23T12:01:27.68446-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-td3","type":"blocks","created_at":"2025-12-23T12:01:27.854807-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-11f","type":"blocks","created_at":"2025-12-23T12:01:27.958452-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-hnh","type":"blocks","created_at":"2025-12-23T12:01:28.058495-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-ihz","type":"blocks","created_at":"2025-12-23T12:01:28.156492-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-ms5","type":"blocks","created_at":"2025-12-23T12:01:28.249671-07:00","created_by":"daemon"},{"issue_id":"plonk-t3n","depends_on_id":"plonk-uz5","type":"blocks","created_at":"2025-12-23T12:49:31.167235-07:00","created_by":"daemon"}]}
{"id":"plonk-t8k","title":"Merge small test files into related suites","description":"## Problem\nSeveral test files have very few tests and would be better consolidated:\n\n### Current State\n| File | Test Count | Suggested Merge Target |\n|------|------------|------------------------|\n| `02-output-formats.bats` | 1 test | `01-basic-commands.bats` |\n| `12-zero-config-package-install.bats` | 2 tests | `03-package-install.bats` |\n| `test-go-debug.bats` | 1 test (debug only) | Delete or move to `debug/` |\n\n### Test File Numbering Gaps\nFiles 11 and 17 are missing in the sequence, suggesting previous consolidation or deletion. The numbering should be cleaned up after merging.\n\n## Proposed Actions\n\n1. **Merge `02-output-formats.bats` into `01-basic-commands.bats`**\n   - Only 1 test: \"status supports table format (default)\"\n   - Fits logically with basic command tests\n\n2. **Merge `12-zero-config-package-install.bats` into `03-package-install.bats`**\n   - Only 2 tests about zero-config install behavior\n   - Should be grouped with other install tests\n\n3. **Handle `test-go-debug.bats`**\n   - This appears to be a debug/development file\n   - Either delete or move to a `debug/` directory excluded from main runs\n\n4. **Renumber files** after consolidation to remove gaps\n\n## Benefits\n- Fewer file switches during test runs\n- Easier to find related tests\n- Cleaner directory structure\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T11:59:24.918637-07:00","updated_at":"2025-12-23T17:10:44.963024-07:00","closed_at":"2025-12-23T17:10:44.963024-07:00","close_reason":"Closed"}
{"id":"plonk-td3","title":"Standardize package manager availability checks","description":"## Problem\nThere are inconsistent patterns for checking package manager availability:\n\n### Pattern 1: Manual check with skip\n```bash\nrun which npm\nif [[ $status -ne 0 ]]; then\n  skip \"npm not available\"\nfi\n```\n\n### Pattern 2: Using helper function\n```bash\nrequire_package_manager \"npm\"\n```\n\n### Pattern 3: Mixed (check then require)\n```bash\nrun which cargo\nif [[ $status -ne 0 ]]; then\n  skip \"cargo not available\"\nfi\n# Later also calls require_safe_package which might skip again\n```\n\n## Current Usage (approximate counts)\n- Manual `which` check: ~15 occurrences\n- `require_package_manager`: ~25 occurrences\n- Both in same test: ~5 occurrences\n\n## Proposed Solution\n1. Standardize on `require_package_manager` helper for all availability checks\n2. Update all tests to use the helper consistently\n3. Consider adding to `require_safe_package` so it auto-checks manager availability:\n\n```bash\nrequire_safe_package() {\n  local package=\"$1\"\n  local manager=\"${package%%:*}\"\n  \n  # Auto-check manager availability\n  require_package_manager \"$manager\"\n  \n  if ! is_safe_package \"$package\"; then\n    skip \"Package $package not in safe list\"\n  fi\n}\n```\n\n## Files to Update\n- `03-package-install.bats`\n- `04-package-uninstall.bats`\n- `07-apply-behavior.bats`\n- `08-package-upgrade.bats`\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:59:36.59959-07:00","updated_at":"2025-12-23T14:55:11.694644-07:00","closed_at":"2025-12-23T14:55:11.694644-07:00","close_reason":"Updated require_safe_package to auto-check manager availability; removed redundant manual checks from test files and helpers"}
{"id":"plonk-tyd","title":"Remove GenericManager and YAML config code","description":"Delete GenericManager, manager config loading, YAML manager definitions, ManagerRegistry complexity. Clean removal after hardcoded managers are working.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:45:44.164879-07:00","updated_at":"2025-12-22T13:58:24.62744-07:00","closed_at":"2025-12-22T13:58:24.62744-07:00","close_reason":"Removed GenericManager, YAML config loading, and metadata extractors. Updated registry to use hardcoded switch, simplified helpers with hardcoded install hints, and fixed all tests.","dependencies":[{"issue_id":"plonk-tyd","depends_on_id":"plonk-vsn","type":"blocks","created_at":"2025-12-22T12:45:56.403619-07:00","created_by":"daemon"},{"issue_id":"plonk-tyd","depends_on_id":"plonk-5ns","type":"blocks","created_at":"2025-12-22T12:45:56.499788-07:00","created_by":"daemon"},{"issue_id":"plonk-tyd","depends_on_id":"plonk-3wu","type":"blocks","created_at":"2025-12-22T12:45:56.591826-07:00","created_by":"daemon"},{"issue_id":"plonk-tyd","depends_on_id":"plonk-adu","type":"blocks","created_at":"2025-12-22T12:45:56.682232-07:00","created_by":"daemon"},{"issue_id":"plonk-tyd","depends_on_id":"plonk-orj","type":"blocks","created_at":"2025-12-22T12:45:56.77217-07:00","created_by":"daemon"}]}
{"id":"plonk-u4t","title":"Review commands package structure","description":"40 files implementing CLI commands. Look for duplication, overly complex command setup, or consolidation opportunities.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:37:08.463341-07:00","updated_at":"2025-12-22T21:56:05.379337-07:00","closed_at":"2025-12-22T21:56:05.379337-07:00","close_reason":"Reviewed: 18 production files with consistent patterns. Created plonk-4r1 (remove shared.go aliases) and plonk-p55 (consolidate validation patterns)."}
{"id":"plonk-uz2","title":"Fix selective apply: use Destination field instead of Metadata","description":"## Root Cause\n\nIn `internal/commands/apply.go:154-169`, the selective apply builds `managedDests` by looking for `item.Metadata[\"destination\"]`:\n\n```go\nfor _, item := range dotfileResult.Managed {\n    if dest, ok := item.Metadata[\"destination\"].(string); ok {\n        normalizedDest, err := normalizePathWithHome(dest, homeDir)\n        // ...\n    }\n}\n```\n\nBut `GetConfiguredDotfiles()` in `config_handler.go` sets `item.Destination` field, NOT `item.Metadata[\"destination\"]`:\n\n```go\nitems = append(items, DotfileItem{\n    Name:        name,\n    Source:      source,\n    Destination: actualDestination,  // Set here\n    // No Metadata set\n})\n```\n\n## Impact\n\nSelective apply (`plonk apply ~/.vimrc`) always fails with \"file not managed by plonk\" because the destination lookup never finds matches.\n\n## Fix\n\nEither:\n1. Change apply.go to use `item.Destination` instead of `item.Metadata[\"destination\"]`\n2. Or set Metadata[\"destination\"] in GetConfiguredDotfiles()\n\nOption 1 is cleaner since Destination is a proper field.\n\n## Affected Tests (10-drift-and-sync.bats)\n- \"plonk apply with file argument only applies that file\"\n- \"plonk apply with multiple file arguments validates all\"\n- \"complete workflow: drift, check status, sync back, apply selectively\"\n\n## Files\n- internal/commands/apply.go:154-169","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T10:44:38.101485-07:00","updated_at":"2025-12-23T11:11:12.929525-07:00","closed_at":"2025-12-23T11:11:12.929525-07:00","close_reason":"Fixed by using item.Destination instead of item.Metadata[\"destination\"] in apply.go"}
{"id":"plonk-uz5","title":"Update Docker test environment to match supported package managers","description":"## Problem\nThe Docker test environment verifies package managers that plonk doesn't actually support:\n\nCurrent verification output shows:\n- pipx: 1.8.0 ✓ (NOT SUPPORTED by plonk)\n- Conda: conda 25.9.1 ✓ (NOT SUPPORTED by plonk)\n\n## Plonk Supported Package Managers\nBased on `internal/packages/*.go`:\n- brew\n- bun\n- cargo\n- gem\n- go\n- npm\n- pnpm\n- uv\n\n## Changes Needed\n1. Update `scripts/docker-entrypoint.sh` or verification script to only check supported managers\n2. Optionally remove pipx and conda from Docker image (saves image size)\n3. Consider adding bun to Docker image if not present\n\n## Related Work\nThis was discovered while fixing upgrade tests (plonk-6k7) where we removed pipx/pixi/conda references from the BATS test suite.\n\n## Parent Epic\nplonk-3gi","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:49:11.826029-07:00","updated_at":"2025-12-23T13:06:20.860474-07:00","closed_at":"2025-12-23T13:06:20.860474-07:00","close_reason":"Removed pipx and conda from Docker image (not supported by plonk). Added bun installation. Updated Dockerfile header and entrypoint verification to match supported package managers: brew, npm, pnpm, bun, cargo, gem, go, uv."}
{"id":"plonk-vsn","title":"Implement hardcoded brew manager","description":"Create dedicated brew manager with: install/uninstall/list commands, self-installation via official script, idempotent error handling. No YAML config.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:45:34.987014-07:00","updated_at":"2025-12-22T13:15:41.188035-07:00","closed_at":"2025-12-22T13:15:41.188035-07:00","close_reason":"Implemented BrewManager with all PackageManager and PackageUpgrader methods, idempotent error handling, and self-installation support. Added comprehensive tests.","dependencies":[{"issue_id":"plonk-vsn","depends_on_id":"plonk-yb6","type":"blocks","created_at":"2025-12-22T12:45:54.096827-07:00","created_by":"daemon"}]}
{"id":"plonk-whr","title":"Review config package for simplification","description":"12 files for configuration. Check if validation, defaults, and backward compatibility handling is overly complex.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T20:37:08.819857-07:00","updated_at":"2025-12-22T21:49:27.341268-07:00","closed_at":"2025-12-22T21:49:27.341268-07:00","close_reason":"Review complete. Found config package moderately over-engineered. Created 6 follow-up issues: plonk-nc5 (P2: externalize 72 hardcoded patterns), plonk-jkg (P3: remove dead code), plonk-zc4 (P3: consolidate defaults), plonk-77w (P3: simplify UserDefinedChecker), plonk-2m5 (P4: cache validator), plonk-x5v (P3: refactor global state)."}
{"id":"plonk-x40","title":"Inject dependencies in packages Apply() for testability","description":"Apply() has hard dependencies on GetRegistry(), lock.NewYAMLLockService(), output.NewSpinnerManager(). Pass as parameters to enable testing orchestration logic.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T21:59:01.480731-07:00","updated_at":"2025-12-23T16:40:18.45318-07:00","closed_at":"2025-12-23T16:40:18.45318-07:00","close_reason":"Added ApplyWith() that accepts lockService, registry, and showProgress flag for testability"}
{"id":"plonk-x5v","title":"Refactor validManagers global state","description":"validManagers uses global mutable state with SetValidManagers(). Consider hardcoding valid managers list or using dependency injection pattern.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T21:48:55.974146-07:00","updated_at":"2025-12-23T16:17:12.032665-07:00","closed_at":"2025-12-23T16:17:12.032665-07:00","close_reason":"Refactored to use ManagerChecker callback instead of SetValidManagers global state"}
{"id":"plonk-xlh","title":"Create HealthCheck builder in diagnostics","description":"All 10 check functions have identical 8-line initialization boilerplate. Create NewHealthCheck() builder with AddIssue/FailWithIssues methods. ~35 lines saved.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T22:13:30.977097-07:00","updated_at":"2025-12-23T16:50:54.270293-07:00","closed_at":"2025-12-23T16:50:54.270293-07:00","close_reason":"Added NewHealthCheck builder, refactored all 10 check functions to use it"}
{"id":"plonk-yb6","title":"Audit current GenericManager and config-driven manager code","description":"## Audit: GenericManager and Config-Driven Manager Code\n\n### Files to Delete/Replace\n\n**Core Implementation (DELETE)**\n- `internal/resources/packages/generic.go` (386 lines) - GenericManager implementation\n- `internal/resources/packages/generic_test.go` (680 lines) - tests\n\n**Config Types (SIMPLIFY)**\n- `internal/config/managers.go` (182 lines) - ManagerConfig, ListConfig, CommandConfig, etc.\n- `internal/config/managers_defaults.go` (245 lines) - GetDefaultManagers() with 8 manager configs\n- `internal/config/user_defined.go` (291 lines) - diff/merge logic for user overrides\n\n**Registry (SIMPLIFY)**  \n- `internal/resources/packages/registry.go` (107 lines) - v2Managers map, LoadV2Configs\n\n### Current Default Managers (in managers_defaults.go)\n- pipx ❌ REMOVE\n- cargo ✅ KEEP  \n- gem ❌ REMOVE\n- brew ✅ KEEP\n- npm ✅ KEEP (with provider swapping)\n- pnpm ✅ KEEP (as npm provider)\n- conda ❌ REMOVE\n- uv ✅ KEEP\n\n### Missing Manager\n- go ⚠️ ADD NEW - not currently implemented\n\n### Impact Radius (files using GenericManager/ManagerRegistry)\nCommands: install.go, uninstall.go, upgrade.go\nClone: setup.go\nDiagnostics: health.go\nResources: operations.go, spec.go, resource.go, init.go\n~15 test files\n\n### Tests to Update (~1563 lines total)\n- generic_test.go (680 lines) - DELETE entirely\n- registry_test.go (48 lines) - heavy refactor\n- registry_v2_test.go (146 lines) - DELETE entirely  \n- managers_test.go (201 lines) - simplify\n- user_defined_test.go (317 lines) - DELETE entirely\n- validators_test.go (171 lines) - simplify (remove listconfig validator)\n\n### Key Decisions for Implementation\n1. Create dedicated manager files: brew.go, npm.go, cargo.go, go.go, uv.go\n2. Each implements PackageManager interface directly\n3. npm.go handles provider swapping (npm/pnpm/bun)\n4. Remove all YAML config parsing for managers\n5. Registry becomes simple name→manager lookup\n6. Self-installation support per manager","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T12:45:34.828651-07:00","updated_at":"2025-12-22T12:50:20.2044-07:00","closed_at":"2025-12-22T12:50:20.2044-07:00","close_reason":"Audit complete. Documented all files to delete/modify, impact radius, and implementation decisions."}
{"id":"plonk-ynr","title":"Consolidate Install/Uninstall loop patterns in operations.go","description":"Install and Uninstall loops in operations.go follow nearly identical pattern. Could be a generic function with operation-specific callback.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T21:59:01.815157-07:00","updated_at":"2025-12-23T16:29:19.65592-07:00","closed_at":"2025-12-23T16:29:19.65592-07:00","close_reason":"Won't fix: loop pattern is only ~5 lines of idiomatic Go. Manager resolution differs meaningfully between install/uninstall. Abstracting would add complexity without benefit."}
{"id":"plonk-zc4","title":"Consolidate default application in config","description":"Default application is scattered across config.go, config_edit.go, and compat.go. Consolidate to single location in LoadFromPath().","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T21:48:55.489013-07:00","updated_at":"2025-12-23T15:36:23.346148-07:00","closed_at":"2025-12-23T15:36:23.346148-07:00","close_reason":"Closed"}
